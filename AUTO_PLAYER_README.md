# 自动出牌功能说明

## 概述

自动出牌功能是麻将助手的一个扩展功能，可以在对战过程中自动分析手牌并做出最佳决策，包括切牌、鸣牌、立直和和牌等操作。

## 功能特点

- 🤖 **智能决策**: 基于先进的麻将算法，综合分析速度、打点、和率等因素
- 🛡️ **安全控制**: 支持操作确认机制，避免误操作
- 📊 **多种策略**: 提供激进、平衡、防守三种策略模式
- ⚙️ **灵活配置**: 可自定义置信度阈值、防守阈值、操作延迟等参数
- 🔄 **实时控制**: 可随时启用/禁用自动出牌功能

## 安装和启用

### 1. 命令行启动

```bash
# 启用自动出牌（默认平衡策略）
./mahjong-helper -auto

# 指定策略
./mahjong-helper -auto -auto-config aggressive

# 其他参数
./mahjong-helper -auto -auto-config defensive -port 12121
```

### 2. 配置文件

程序会自动创建 `auto_player_config.json` 配置文件：

```json
{
  "enabled": false,
  "autoDiscard": true,
  "autoMeld": false,
  "autoRiichi": false,
  "autoAgari": true,
  "minConfidence": 0.7,
  "defenseThreshold": 0.15,
  "delaySeconds": 1.0,
  "confirmActions": true,
  "strategy": "balanced"
}
```

## 配置参数说明

### 基础设置

- `enabled`: 是否启用自动出牌功能
- `autoDiscard`: 是否自动切牌
- `autoMeld`: 是否自动鸣牌
- `autoRiichi`: 是否自动立直
- `autoAgari`: 是否自动和牌

### 高级参数

- `minConfidence`: 最小置信度阈值 (0.0-1.0)
  - 低于此值的决策不会执行
  - 建议设置: 0.6-0.8

- `defenseThreshold`: 防守阈值 (0.0-1.0)
  - 超过此值时优先选择安全牌
  - 建议设置: 0.1-0.3

- `delaySeconds`: 操作延迟秒数 (0.0-10.0)
  - 避免操作过快被检测
  - 建议设置: 1.0-3.0

- `confirmActions`: 是否需要确认操作
  - true: 每次操作前会询问确认
  - false: 直接执行操作

### 策略类型

- `aggressive` (激进): 优先考虑进攻，追求和牌
- `balanced` (平衡): 平衡进攻和防守，考虑局收支
- `defensive` (防守): 优先考虑安全，避免放铳

## 交互模式命令

在交互模式中，可以使用以下命令：

```bash
# 基础命令
auto-on          # 启用自动出牌
auto-off         # 禁用自动出牌
auto-toggle      # 切换自动出牌状态
auto-config      # 显示当前配置

# 策略设置
auto-strategy aggressive   # 设置激进策略
auto-strategy balanced     # 设置平衡策略
auto-strategy defensive    # 设置防守策略

# 参数调整
auto-delay 1.5             # 设置1.5秒延迟
auto-threshold 0.2         # 设置0.2防守阈值
auto-confidence 0.8        # 设置0.8最小置信度
auto-confirm on            # 启用操作确认
auto-confirm off           # 禁用操作确认

# 配置管理
auto-reset                 # 重置为默认配置
auto-help                  # 显示帮助信息
```

## 使用场景

### 1. 学习模式
- 启用确认机制 (`auto-confirm on`)
- 使用平衡策略
- 观察AI的决策过程，学习麻将技巧

### 2. 辅助模式
- 只在关键时刻启用
- 使用防守策略避免放铳
- 保持较低的操作频率

### 3. 自动模式
- 禁用确认机制
- 根据局势切换策略
- 适合练习或休闲对战

## 安全提醒

⚠️ **重要提醒**:

1. **合规使用**: 请确保在允许的平台上使用，遵守相关规则
2. **合理配置**: 建议保持适当的操作延迟，避免操作过快
3. **谨慎启用**: 自动和牌等功能可能影响游戏体验，请谨慎使用
4. **手动确认**: 建议启用操作确认机制，避免不合理的自动操作

## 技术原理

自动出牌功能基于以下算法：

1. **向听数分析**: 计算当前手牌的向听数和改良效果
2. **危险度评估**: 基于筋牌、宝牌、他家信息计算放铳危险度
3. **期望值计算**: 综合考虑速度、打点、和率的期望收益
4. **决策优化**: 根据策略偏好选择最优操作

## 故障排除

### 常见问题

1. **自动出牌不工作**
   - 检查是否已启用 (`auto-config`)
   - 确认配置文件是否正确
   - 检查置信度阈值是否过高

2. **操作被拒绝**
   - 检查游戏是否在允许操作的状态
   - 确认手牌张数是否正确
   - 查看错误日志信息

3. **决策不合理**
   - 调整策略设置
   - 修改置信度阈值
   - 检查危险度评估参数

### 调试模式

启用调试模式可以看到更详细的决策过程：

```bash
./mahjong-helper -auto -debug
```

## 更新日志

- **v1.0**: 基础自动出牌功能
- 支持切牌、鸣牌、立直、和牌操作
- 提供三种策略模式
- 支持配置文件管理

## 贡献

欢迎提交 Issue 和 Pull Request 来改进自动出牌功能！

## 许可证

本功能遵循主项目的 MIT 许可证。
